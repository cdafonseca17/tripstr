
<div class="container">

  <div class="profile_box">
    <% if @user.photo.present? %>
      <%= cl_image_tag @user.photo, class: "avatar-large" %>
    <% else %>
      <%= image_tag "no_prof_pic_present.jpg", class: 'avatar-large' %>
    <% end %>

 <!-- Button trigger modal -->
    <button type="button" class="btn btn-primary mr-4" data-toggle="modal" data-target="#UploadPhotoModal">
      Upload Photo
    </button>

    <!-- Modal -->
    <div class="modal fade" id="UploadPhotoModal" tabindex="-1" role="dialog" aria-labelledby="addUploadPhotoModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addUploadPhotoModalLabel">Upload a cool selfie from your last adventure!</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <%= simple_form_for(@user) do |f| %>
            <%= f.input :photo %>
            <%= f.input :photo_cache, as: :hidden %>
            <%= f.submit "Upload", class: "btn btn-primary"%>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <div class="username_box">
      <p> <%= @user.username %> </p>
    </div>
    <div class="user_countries">
      <p><strong>COUNTRIES</strong></p>
      <p><%= @user.trips.count %></p>
    </div>
    <div class="user_contributions">
      <p><strong>CONTRIBUTIONS</strong></p>
      <% array = [] %>
      <% @user.trips.each do |trip| %>
        <% array << trip.steps.count %>
        <% array << trip.activities.count %>
        <% end %>
      <p><%= @user.trips.count + array.sum%></p>
    </div>
  </div>

  <!-- <div class="map_container">
  </div> -->

<script src="https://www.amcharts.com/lib/3/ammap.js" type="text/javascript"></script>
<script src="https://www.amcharts.com/lib/3/maps/js/worldHigh.js" type="text/javascript"></script>
<script src="https://www.amcharts.com/lib/3/themes/dark.js" type="text/javascript"></script>
<div id="mapdiv" style="width: 100%; height: 450px;"></div>
<div style="width: 1000px; font-size: 70%; padding: 2px 0; text-align: center; background-color: #FFFFFF; margin-top: 1px; color: #edeaea;"><a href="https://www.amcharts.com/visited_countries/" style="color: #edeaea;">Create your own visited countries map</a> or check out the <a href="https://www.amcharts.com/" style="color: #edeaea;">JavaScript Charts</a>.</div> -->

<% country_codes = @user.trips.map {|trip| trip.country_code} %>
<% country_codes_map = [] %>
<% country_codes.each do |country_code| %>
  <% hash = Hash.new %>
  <% hash["id"] = country_code %>
  <% hash["showAsSelected"] = true %>
  <% country_codes_map << hash %>
<% end %>
<% @country = country_codes_map %>
<%#= country.to_json %>
<%# @country_json = country_codes_map.to_json %>
<!-- <p id="thisThing" data-url="<%= @country_codes_map %>"><%= @country_codes_map %></p> -->

<script type="text/javascript">
  var country = JSON.parse('<%= raw(@country.to_json) %>')
  console.log(country)
  var map = AmCharts.makeChart("mapdiv",{
    type: "map",
    theme: "dark",
    projection: "mercator",
    panEventsEnabled : true,
    backgroundColor : "#FFFFFF",
    backgroundAlpha : 1,
    zoomControl: {
    zoomControlEnabled : true
    },
    dataProvider : {
    map : "worldHigh",
    getAreasFromMap : true,
    areas : country
    },
    areasSettings : {
    autoZoom : false,
    color : "#edeaea",
    colorSolid : "#10B97",
    selectedColor : "#10B97C",
    outlineColor : "##c9c5c5",
    rollOverColor : "#c9c5c5",
    rollOverOutlineColor : "#c9c5c5"
    }
    });
</script>
